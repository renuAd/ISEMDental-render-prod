{% extends "core/base.html" %} {% block title %}Profile{% endblock %}
<!--prettier ignore-->
{% block content %}
<div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow">
  <h1 class="text-2xl font-bold mb-6 text-green-700">Profile</h1>

  <form method="post" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}

    <!-- Profile Photo -->
    <div class="flex items-center space-x-4">
      <div class="relative">
        <div
          class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden"
        >
          <!-- Existing avatar if available -->
          {% if user.profile.avatar %}
          <img
            src="{{ user.profile.avatar.url }}"
            alt="Profile Photo"
            class="w-full h-full object-cover"
          />
          {% else %}
          <span class="text-gray-500 text-sm">No Photo</span>
          {% endif %}
        </div>
        <!-- Remove button (only shows if avatar exists) -->
        {% if user.profile.avatar %}
        <button type="button"
                onclick="deleteAvatar()"
                class="absolute bottom-0 right-0 bg-red-500 text-white p-1 rounded-full hover:bg-red-600 shadow-md transition-colors">
          <span class="material-icons text-base">close</span>
        </button>
        {% endif %}
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Profile Photo</label
        >
        <input
          type="file"
          name="avatar"
          class="block w-full text-sm text-gray-700 border border-gray-300 rounded-lg px-3 py-2"
        />
      </div>
    </div>

    <!-- First Name -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1"
        >First Name</label
      >
      <input
        type="text"
        name="first_name"
        value="{{ user.first_name }}"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"
      />
    </div>

    <!-- Last Name -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1"
        >Last Name</label
      >
      <input
        type="text"
        name="last_name"
        value="{{ user.last_name }}"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"
      />
    </div>

    <!-- Username -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1"
        >Username</label
      >
      <input
        type="text"
        name="username"
        value="{{ user.username }}"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"
      />
    </div>

    <!-- Email Address -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1"
        >Email Address</label
      >
      <input
        type="email"
        name="email"
        value="{{ user.email }}"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500"
      />
    </div>

    <!-- Save Button -->
    <div class="pt-4">
      <button
        type="submit"
        class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg shadow"
      >
        Save
      </button>
    </div>
  </form>
</div>

<script>
function deleteAvatar() {
    if (confirm('Are you sure you want to remove your profile picture?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = "{% url 'userprofile:delete_avatar' %}";
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken;
        
        form.appendChild(csrfInput);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
