{% extends 'core/base.html' %}
{% load static %}

{% block title %}Appointments{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
{% endblock %}

{% block content %}

<div class="w-full">
  <!-- Page header -->
  <div class="w-full px-3 py-3 md:p-4 rounded-xl">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <h4 class="capitalize text-lg font-medium">Appointments</h4>
      <nav aria-label="breadcrumb" class="mt-2 md:mt-0">
        <ol class="flex space-x-2 text-sm text-gray-500">
          <li>
            <a href="{% url 'dashboard:index' %}" class="hover:text-gray-700 flex items-center gap-1">
              <i class="las la-home"></i> Dashboard
            </a>
          </li>
          <li class="text-gray-400">/</li>
          <li class="text-gray-700 font-medium">Appointments</li>
        </ol>
      </nav>
    </div>
  </div>
</div>

<!-- Main layout: calendar + timeline -->
<div class="flex flex-col lg:flex-row gap-4 mt-6 items-stretch">
  <!-- Calendar section -->
  <div class="flex flex-col w-full lg:flex-1 lg:max-w-[700px]">
    <!-- Create appointment button (full width, outside card) -->
    <button id="create-appointment-btn"
      class="w-full mb-3 px-3 py-2 text-sm bg-green-600 text-white rounded-md flex items-center justify-center gap-1 hover:bg-green-700 transition">
      <i class="la la-plus"></i> Create Appointment
    </button>

    <!-- Calendar card -->
    <div class="bg-white p-3 md:p-5 lg:p-6 rounded-xl shadow flex flex-col w-full">
      <!-- Drop down Branch Select-->
      <div class="mb-4">
        <label class="font-semibold">Select Branch:</label>
        <select id="branch-filter"
                class="border p-2 rounded-md text-sm">
          <option value="">All Branches</option>
          <option value="Vigan">Vigan</option>
          <option value="Santo Domingo">Santo Domingo</option>
        </select>
      </div>
      
      <div class="w-full overflow-x-auto">
        <div id="calendar" class="w-full md:min-w-[360px]"></div>
      </div>
    </div>
  </div>

 <!-- Timeline + list section -->
<div class="w-full lg:flex-1">
  <div class="bg-white p-3 md:p-4 lg:p-6 rounded-xl shadow w-full">
    <!-- Timeline legend (STATUS COLORS) -->
    <div class="flex flex-wrap items-center justify-center gap-4 mb-4 text-sm text-slate-700">
      <span class="flex items-center gap-2">
        <span class="h-3 w-3 rounded-full" style="background-color:#9CA3AF;"></span>
        Not yet arrived
      </span>
      <span class="flex items-center gap-2">
        <span class="h-3 w-3 rounded-full" style="background-color:#3B82F6;"></span>
        Arrived
      </span>
      <span class="flex items-center gap-2">
        <span class="h-3 w-3 rounded-full" style="background-color:#F59E0B;"></span>
        On going
      </span>
      <span class="flex items-center gap-2">
        <span class="h-3 w-3 rounded-full" style="background-color:#10B981;"></span>
        Done
      </span>
      <span class="flex items-center gap-2">
        <span class="h-3 w-3 rounded-full" style="background-color:#EF4444;"></span>
        Cancelled
      </span>
    </div>


    <div class="w-full overflow-x-auto mb-4">
      <!-- NEW scrollable wrapper -->
      <div id="timeline-scroll" style="overflow-y: auto;">
        <div id="timeline-calendar" class="w-full md:min-w-[360px]"></div>
      </div>
    </div>

    <!-- Timeline list -->
    <div class="relative pl-3 md:pl-4 border-l border-gray-300 max-h-[400px] md:max-h-[600px] overflow-y-auto">
      <ul id="todays-appointments-list" class="space-y-6"></ul>
    </div>
  </div>
</div>


{# Put the includes here, after the main layout #}
{% include "appointment/appointment_modal.html" %}
{% include "appointment/done_steps_modal.html" %}
{% include "appointment/reschedule_modal.html" %}
{% include "appointment/pop_up_modals.html" %}
{% include "appointment/followup_modal.html" %}
{% include "appointment/notify_modal.html" %}
{% include "appointment/status_modal.html" %}

{% endblock %}


{% block extra_js %}



<script>
  // dont remove this, this should be in the Calendar.js but no, it dont work if its in therre!
  const eventsUrl = "{% url 'appointment:events' %}";
</script>

<script src="{% static 'vendor/fullcalendar/index.global.min.js' %}"></script>
{% comment %} <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script> {% endcomment %}
<script src="{% static 'js/calendar.js' %}"></script>
<script src="{% static 'js/appointment.js' %}"></script>

{% endblock %}
